const { expect } = require("chai")
const { ethers } = require("hardhat")

describe("Deploy the attack", () => {
    it("Should change the owner of the Good contract", async () => {
        //Deploy the helper contract
        const helperContractFactory = await ethers.getContractFactory("Helper")
        const helperContract = await helperContractFactory.deploy()
        await helperContract.deployed()
        console.log(`Helper contract's address: ${helperContract.address}`)

        // Let's deploy the good contract
        const goodContractFactory = await ethers.getContractFactory("Good")
        const goodContract = await goodContractFactory.deploy(helperContract.address)
        await goodContract.deployed()
        console.log(`good contract address: ${goodContract.address}`)

        // Let's deploy the attack contract
        const attackContractFactory = await ethers.getContractFactory("Attack")
        const attackContract = await attackContractFactory.deploy(goodContract.address)
        await attackContract.deployed()
        console.log(`Attack contract address: ${attackContract.address}`)

        // Attack the good contract
        let attackTransaction = await attackContract.attack()
        await attackTransaction.wait(1)

        expect(await goodContract.owner()).to.equal(attackContract.address)
    })
})
